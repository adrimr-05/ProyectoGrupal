---
title: "Proyecto Grupal"
author: "Adriana"
format: html
editor: visual
---

```{r}
library(dplyr)
library(ggplot2)
library(tidyr)
library(readxl)
library(readr)

cancer_cervix <- read.csv("risk_factors_cervical_cancer.csv", na.strings = "?")

cols_integer <- c(
  "Age",
  "Number.of.sexual.partners",
  "First.sexual.intercourse",
  "Num.of.pregnancies",
  "STDs..number.",
  "STDs..Number.of.diagnosis"
)
cols_double <- c(
  "Smokes..years.",
  "Smokes..packs.year.",
  "Hormonal.Contraceptives..years.",
  "IUD..years.",
  "STDs..Time.since.first.diagnosis",
  "STDs..Time.since.last.diagnosis"
)
cols_factor <- c(
  "Smokes",
  "Hormonal.Contraceptives",
  "IUD",
  "STDs",
  "STDs.condylomatosis",
  "STDs.cervical.condylomatosis",
  "STDs.vaginal.condylomatosis",
  "STDs.vulvo.perineal.condylomatosis",
  "STDs.syphilis",
  "STDs.pelvic.inflammatory.disease",
  "STDs.genital.herpes",
  "STDs.molluscum.contagiosum",
  "STDs.AIDS",
  "STDs.HIV",
  "STDs.Hepatitis.B",
  "STDs.HPV",
  "Dx.Cancer",
  "Dx.CIN",
  "Dx.HPV",
  "Dx",
  "Hinselmann",
  "Schiller",
  "Citology",
  "Biopsy"
)



cancer_cervix <- cancer_cervix %>%
  mutate(across(all_of(cols_integer), ~ as.integer(round(as.numeric(.))))) %>%
  mutate(across(all_of(cols_double), ~ as.double(as.numeric(.)))) %>%
  mutate(across(all_of(cols_factor), ~ factor(ifelse(as.numeric(.) == 1, "Sí",
  ifelse(as.numeric(.) == 0, "No", NA)), levels = c("No", "Sí"))))

#Aqui verificamos lo cambios
str(cancer_cervix)
```

##1- Identifique los siguientes puntos para los datos con los que realizará su proyecto:

Caraterísticas de sus datos. Es un dataframe que contiene datos medicos sobre pacientes de cancer cervico, el dataframe contiene 36 variables que incluye datos demograficos, habitos uso de metodos anticonceptibos e historial de enfermedades de transmision sexual entre otros padecimientos medicos. El analisis conlleva tanto herramientas cuantitativas y cualitativas.

Población de estudio. La poblacion del estudio son un grupo de mujeres de Venezuela Caracas en las cuales son todas mujeres en edad reproductiva que participaron en una deteccion temprana del cancer cervico.

Muestra observada. La muestra son las 858 mujeres que salen en el dataframe ya que son datos que fueron guardados con el fin de poder analizarlo y representan una parte de todas las mujeres que pudieron haber atendido.

Unidad estadística o individuos. Cada fila del conjunto de datos representa una mujer evaluada individualmente, incluyendo sus características personales, historial médico y resultados de diagnóstico.

Identificar las variables de estudio.

Numéricas (enteras / conteos):

-Age (edad, entero)

-Number of sexual partners (entero)

-First sexual intercourse (edad 1ª relación, entero)

-Num of pregnancies (entero)

-STDs (number) (conteo, entero)

-STDs: Number of diagnosis (conteo, entero)

-Numéricas continuas (años/tasas):

-Smokes (years) (años fumando)

-Smokes (packs/year) (paquetes/año)

-Hormonal Contraceptives (years) (años)

-IUD (years) (años)

-STDs: Time since first diagnosis (años)

-STDs: Time since last diagnosis (años)

-(0/1) → Factor:

-Smokes

-Hormonal Contraceptives

-IUD

-STDs

-Específicas de ETS : STDs:condylomatosis, STDs:cervical condylomatosis, STDs:vaginal condylomatosis, STDs:vulvo-perineal condylomatosis, STDs:syphilis, STDs:pelvic inflammatory disease, STDs:genital herpes, STDs:molluscum contagiosum, STDs:AIDS, STDs:HIV, STDs:Hepatitis B, STDs:HPV

-Diagnósticos/targets : Dx:Cancer, Dx:CIN, Dx:HPV, Dx, Hinselmann, Schiller, Citology, Biopsy

2- Agregar las primeras 5 filas de su tabla de datos.

```{r}

head(cancer_cervix, 5)

#Se cambian los NA por la mediana de cada variable
df_imputado <- cancer_cervix

for (col in names(df_imputado)) {
  if (is.numeric(df_imputado[[col]])) {
    mediana <- median(df_imputado[[col]], na.rm = TRUE)
    df_imputado[[col]][is.na(df_imputado[[col]])] <- mediana
  }
}
#Primero se identifican las variables cuantitativas
vars_cuantitativas <- c(
  "Age",
  "Number.of.sexual.partners",
  "First.sexual.intercourse",
  "Num.of.pregnancies",
  "STDs..number.",
  "STDs..Number.of.diagnosis",
  "Smokes..years.",
  "Smokes..packs.year.",
  "Hormonal.Contraceptives..years.",
  "IUD..years.",
  "STDs..Time.since.first.diagnosis",
  "STDs..Time.since.last.diagnosis"
)

resumen <- df_imputado %>%
  select(all_of(vars_cuantitativas)) %>%
  summary()

resumen

#### 4. Gráficos de distribución de las variables cuantitativas

vars_cuantitativas <- c(cols_integer, cols_double)

for (var in vars_cuantitativas) {
  grafico <- ggplot(cancer_cervix, aes(x = .data[[var]])) +
    geom_histogram(binwidth = 1, fill = "skyblue", color = "white") +
    theme_minimal()+
     theme(
      plot.title = element_text(face = "bold", color = "#00264d", size = 15, hjust = 0.5),
      axis.title = element_text(color = "#003366"),
      panel.grid.minor = element_blank(),
      panel.grid.major.x = element_blank(),
      plot.background = element_rect(fill = "white", color = NA)
    ) +
    labs(
      title = paste("Distribución de", var),
      x = var,
      y = "Cantidad de personas"
    )
  print(grafico)
}


cancer_cervix_clean <- cancer_cervix %>%
  mutate(across(where(is.numeric), ~ ifelse(is.na(.), 0, .)))

#Este gráfico muestra si existe una relación entre la edad y el número de parejas sexuales.
ggplot(cancer_cervix_clean, aes(x = Age, y = Number.of.sexual.partners)) +
  geom_boxplot(alpha = 0.6, color = "red")  +
  labs(title = "Edad vs Número de Parejas Sexuales",
       x = "Edad",
       y = "Número de Parejas Sexuales") +
  theme_minimal()


# Muestra la relación entre la edad de inicio y el número de parejas. 
ggplot(cancer_cervix_clean, aes(x = First.sexual.intercourse, y = Number.of.sexual.partners)) +
  geom_boxplot(alpha = 0.6, color = "purple") +
  labs(title = "Edad de inicio de relaciones sexuales vs Número de parejas sexuales",
       x = "Edad de inicio de relaciones sexuales",
       y = "Número de parejas sexuales") +
  theme_minimal()

# Diagnostico de VPH y la aparición de cáncer de cérvix 
ggplot(cancer_cervix_clean, aes(x = factor(Dx.HPV), fill = factor(Dx))) +
  geom_bar(position = "fill") +
  labs(title = "Proporción de diagnóstico de cáncer vs diagnóstico de VPH",
       x = "Diagnóstico de VPH (0 = no, 1 = sí)",
       y = "Proporción",
       fill = "Diagnóstico de cáncer (Dx)") +
  scale_fill_manual(values = c("skyblue", "tomato")) +
  theme_minimal()


ggplot(cancer_cervix_clean, aes(x = factor(Hormonal.Contraceptives))) +
  geom_bar(fill = "darkgreen") +
  labs(title = "Distribución del uso de anticonceptivos hormonales",
       x = "Uso (0 = no, 1 = sí)",
       y = "Cantidad de personas") +
  theme_minimal()


# Seleccionar variables categóricas
cat_vars <- cancer_cervix_clean %>%
  select(Smokes, Hormonal.Contraceptives, IUD, STDs, Dx.Cancer)

# Convertir a formato largo
cat_long <- pivot_longer(cat_vars, cols = everything(), names_to = "variable", values_to = "valor")

# Graficar
ggplot(cat_long, aes(x = variable, fill = factor(valor))) +
  geom_bar(position = "dodge") +
  coord_flip() +
  labs(title = "Factores de Riesgo",
       x = "Variable",
       y = "Cantidad de personas",
       fill = "Valor (0 = no, 1 = sí)")+scale_fill_manual(values = c("gray70","darkmagenta")) +theme_minimal()


# Cantidad de NA por variable
colSums(is.na(cancer_cervix))

# Visualizar outliers con boxplot múltiple
numeric_df <- cancer_cervix %>% select(where(is.numeric)) %>% pivot_longer(cols = everything())


ggplot(numeric_df, aes(x = name, y = value)) +
  geom_boxplot(fill = "lightgreen") +
  coord_flip() +  # <- gira el gráfico
  labs(title = "Posibles outliers en variables numéricas",
       x = "Variable", y = "Valor") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8))



##8- Investigar técnicas que permitan subsanar los valores perdidos y outliers.

##Para manejar los valores faltantes se suelen combinar tres estrategias. (1) Eliminación de casos: descarta filas o celdas con NA, es simple y evita supuestos, pero reduce el tamaño muestral y puede sesgar si la ausencia no es aleatoria. (2) Imputación simple: reemplaza NA con una estadística que puede ser la mediana o la media depende del analisis, preserva el tamaño muestral y es fácil de interpretar, aunque subestima la variabilidad. (3) Imputación multivariante: usa la información conjunta de otras variables para estimar los NA, manteniendo relaciones entre variables y reflejando mejor la incertidumbre, requiere más cómputo y supuestos, pero ofrece imputaciones más realistas.
```
